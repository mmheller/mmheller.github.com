<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!--{% load staticfiles %}-->

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!--The viewport meta tag is used to improve the presentation and behavior of the samples on iOS devices-->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no" />
    <title>Greater Sage Grouse: Conservation Efforts</title>
    <link rel="stylesheet" href="https://js.arcgis.com/3.20/dijit/themes//tundra/tundra.css" />
    <link rel="stylesheet" href="https://js.arcgis.com/3.20/esri/css/esri.css" />


    <!--<link rel="stylesheet" href="https://js.arcgis.com/3.14/dijit/themes//tundra/tundra.css" />
    <link rel="stylesheet" href="https://js.arcgis.com/3.14/esri/css/esri.css" />-->
    <!--  <link rel="stylesheet" href="https://js.arcgis.com/3.12/dijit/themes//tundra/tundra.css"/>
      <link rel="stylesheet" href="https://js.arcgis.com/3.12/esri/css/esri.css"/>-->

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="Styles/panel.css" />
    <!--<link rel="stylesheet" type="text/css" href="{% static 'ced_main/images/grsgmap/Styles/panel.css' %}"/>-->


    <style type="text/css">
        @CHARSET "UTF-8";


        .page-break {
            page-break-after: always;
            page-break-inside: avoid;
            clear: both;
        }

        .page-break-before {
            page-break-before: always;
            page-break-inside: avoid;
            clear: both;
            margin-top:1px;
        }

        .auto-style1 {
            vertical-align: middle;
            text-align: right;
            background-color: rgb(151, 118, 123);
            color: #FFFFFF;
            font-weight: bold;
            height: 59px;
        }

        /*.myDivClass{background:#FFFFFF;}*/
    </style>

    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.3.5/bluebird.min.js"></script>-->  <!--NOT sure if this blubird is needed-->
    <!--<script type="text/javascript"> var ua = window.navigator.userAgent; var msie = ua.indexOf("MSIE "); if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) document.write('<script src=cdnjs.cloudflare.com/ajax/libs/bluebird/3.3.5/…;\/scr'+'ipt>'); </script>-->

    <!--<script type="text/javascript"  src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>-->

    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.4.1/jspdf.min.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.4.1/jspdf.debug.js" integrity="sha384-CchuzHs077vGtfhGYl9Qtc7Vx64rXBXdIAZIPbItbNyWIRTdG0oYAqki3Ry13Yzu" crossorigin="anonymous"></script>

    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js" integrity="sha384-CchuzHs077vGtfhGYl9Qtc7Vx64rXBXdIAZIPbItbNyWIRTdG0oYAqki3Ry13Yzu" crossorigin="anonymous"></script>-->

    <script type="text/javascript">var dojoConfig = {paths: { extras: location.pathname.replace(/\/[^/]+$/, "") + "/extras" }};</script>
    <!--<script type="text/javascript"> var dojoConfig = { paths: { extras: "{% static 'ced_main/images/grsgmap/extras' %}"} };</script>-->
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>   
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script type="text/javascript" src="https://js.arcgis.com/3.20/"></script>


    <script type="text/javascript">
    dojo.require("dijit.layout.TabContainer");
    dojo.require("dijit.layout.ContentPane");
    var app = {};
    require([
        "esri/map", "esri/layers/FeatureLayer", "esri/dijit/Legend", "esri/urlUtils",
        "dojo/_base/array", "dojo/parser", "esri/config", "dojo/dom", "dojo/dom-class", "dojo/on", "extras/PS_MeasSiteSearch4Definition", "extras/PS_ReturnQuerySt",
        "dijit/form/CheckBox", "extras/PS_MeasSiteSearch_SetVisableQueryDef", "extras/MH_Zoom2FeatureLayer", "extras/MH_Setup", "extras/MH_SetupSummaryMap",
        "extras/MH_FeatureCount", "extras/MH_Query4Summary",
        "esri/tasks/RelationshipQuery", "esri/symbols/SimpleMarkerSymbol", "dojo/_base/Color", "esri/dijit/Scalebar",
        "esri/dijit/Geocoder", "extras/PS_Identify", "extras/CK_AutoCompleteSearchAndZoom", "extras/PS_PopUniqueQueryInterfaceValues",
        "esri/geometry/webMercatorUtils", "esri/dijit/BasemapGallery", "dojo/mouse", "dojo/query", "esri/tasks/FindTask", "esri/tasks/FindParameters",
        "esri/arcgis/utils",
        "dijit/layout/BorderContainer", "dijit/layout/ContentPane",
        "dijit/layout/AccordionContainer", "dojo/domReady!"
        ],

    function (Map, FeatureLayer, Legend, urlUtils,
                arrayUtils, parser, esriConfig, dom, domClass, on, PS_MeasSiteSearch4Definition, PS_ReturnQuerySt, CheckBox,
                PS_MeasSiteSearch_SetVisableQueryDef, MH_Zoom2FeatureLayer, MH_Setup, MH_SetupSummaryMap, MH_FeatureCount, MH_Query4Summary,
                RelationshipQuery, SimpleMarkerSymbol,
                Color, Scalebar, Geocoder, PS_Identify, CK_AutoCompleteSearchAndZoom, PS_PopUniqueQueryInterfaceValues,
                webMercatorUtils, BasemapGallery, mouse, query, FindTask, FindParameters) {

        //var 

        //insertStaticMap(app.pSup.map);
        
        app.base64Img1 = null;
        app.base64Img2 = null;
        app.base64Img3 = null;
        imgToBase64('http://mmheller.github.io/testCED/images/CEDlogo_white_180x31.jpg', function (base64) {
            app.base64Img1 = base64;
        })
        var base64Img2 = null;
        imgToBase64('http://mmheller.github.io/testCED/images/USFWS_150x31.jpg', function (base64) {
            app.base64Img2 = base64;
        })
        var base64Img3 = null;
        imgToBase64('http://mmheller.github.io/testCED/images/USGS_117x31.jpg', function (base64) {
            app.base64Img3 = base64;
        })
        
        pdfMargins = { top: 40, bottom: 40, left: 30,width: 624};
        esriConfig.defaults.io.corsEnabledServers.push("https://utility.arcgis.com")
        esriConfig.defaults.io.corsEnabledServers.push("https://services.arcgis.com")
        esriConfig.defaults.io.corsEnabledServers.push("https://sampleserver6.arcgisonline.com")

        parser.parse();

        var strURL = localStorage.getItem("ls_strTheme1_URL");
        var strDefQuery = localStorage.getItem("ls_strDefQuery");
        var strDefQuery2 = localStorage.getItem("ls_strDefQuery2");
        //var strDefQuery3 = localStorage.getItem("ls_strDefQuery3");
        var strQueryLabelText = localStorage.getItem("ls_strQueryLabelText");

        if ((strQueryLabelText == "") | (strQueryLabelText == "undefined")) {
            strQueryLabelText = "<b>USER SELECTED QUERY FILTERS:</b>  None selected"
        } else {
            strQueryLabelText = "<b>USER SELECTED QUERY FILTERS:</b>  " + strQueryLabelText.substring(0, strQueryLabelText.length - 2);
        }
              

        var div = document.getElementById("dFilterParameters");
        div.innerHTML = strQueryLabelText;
        
        app.gQuerySummary = new MH_Query4Summary({ strURL: strURL }); // instantiate the class
        app.gQuerySummary.Summarize(strDefQuery, strDefQuery2, true);

        app.pSupSumMap = new MH_SetupSummaryMap({}); // instantiate the class
        app.arrayLayers = app.pSupSumMap.Phase2();


        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!
        var yyyy = today.getFullYear();
        today = mm + '/' + dd + '/' + yyyy;
        document.getElementById('time').innerHTML = today;

        //function insertStaticMap(pMap) {

        //};
        function getTokens() {
            var tokens = [];
            var query = location.search;
            query = query.slice(1);
            query = query.split('&');
            $.each(query, function (i, value) {
                var token = value.split('|');
                var key = decodeURIComponent(token[0]);
                var data = decodeURIComponent(token[1]);
                tokens[key] = data;
            });
            return tokens;
        };
        
        generate = function () {
            document.getElementById("ImgResultsLoading").style.visibility = "visible";
            app.gQuerySummary.StartPrinting(app.map);
        };
        
    });
    </script>
</head>
   
<body>
    <!--<button onclick="javascript:demoFromHTML()">PDF</button>-->
    <div id="html-2-pdfwrapperORG" style='position: absolute; top: 20px; bottom: 0; overflow: auto; width: 850px; font-family: Arial; padding:0px; margin-left:0px; padding-left:0px; margin:0px;'>
        <table style="width:100%; background-color: #FFFFFF; padding:0px; margin-left:0px; padding-left:0px; margin:0px;">
            <tr>
                <td class="auto-style1">
                    <a href="http://conservationefforts.org/welcome/" target="_blank"> <img id="theImage4" border="0" src="http://conservationefforts.org/static/ced_main/images/ced_main/CEDlogo_white_180x31.png" style="position: absolute; left: 15px; top: 18px; height: 35px;" /></a>
                    <a href="http://www.fws.gov" target="_blank"> <img id="theImage3" border="0" src="http://conservationefforts.org/static/ced_main/images/ced_main/USFWS_150x31.png" height="36" /></a>&nbsp;&nbsp;
                    <a href="http://www.usgs.gov" target="_blank"><img id="theImage2" border="0" src="http://conservationefforts.org/static/ced_main/images/ced_main/USGS_117x31.png" height="36" /></a>
                </td>
            </tr>
        </table>
        <div style="height:15px; position: absolute; top: 70px; right: 10px">
            <img id="ImgResultsLoading" src="images/loading.gif" style="height:15px;" /><button onclick="generate()">Print Report to PDF</button>
        </div>
        <b>Conservation Efforts Database v2.1</b><br />
        <b>Interactive Map - Summary Report</b>




    <div id="mapSum"
         style="overflow:hidden; background-color:rgb(151, 118, 123);">
        <img id="loadingImg" src="images/loading.gif" style="position:fixed; left:30%; top:30%; z-index:100;" />
    </div>

    <div id="panelBasemapsSum" class="panelBasemapsSum bg rounded shadow">
        <!-- Panel Basemaps -->
        <div id="basemapTitleSum"><img src="images/basemaps.png" height="30" title="Switch Base Map" /></div>
        <div id="basemapContent">
            <div id="basemapGallerySummary"></div>
        </div>
    </div>


</b></div>
    <!--<div id="html-2-pdfwrapper" style='position: absolute; left: 20px; top: 150px; bottom: 0; overflow: auto; width: 850px'>-->
    <div id="html-2-pdfwrapper" style='position: absolute; top: 570px; overflow: auto; width: 850px; font-family: Arial;'>
        <b>REPORT GENERATED:</b> <span id="time"></span>
        <div id="dTotalAcresQ2" class="myDivClassNormal"></div>
        <div id="dTotalCalcAcresQ2" class="myDivClassNormal"></div>
        <div id="dTotalProjects" class="myDivClassNormal"></div><div id="dTotalProjCalcAcresQ2" class="myDivClass"></div>
        <div id="dTotalProjectsNon" class="myDivClassNormal"></div><div id="dTotalProjCalcAcresQ2" class="myDivClass"></div>
        <div id="dTotalPlans" class="myDivClassNormal"></div><div id="dTotalPlanCalcAcresQ2" class="myDivClass"></div>
        <br />
        <div id="dFilterParameters" class="myDivClassNormal"></div>
        <div id="dMaxLastDataProviderEdit" class="myDivClassNormal"></div>
        <div id="dMaxLastPubProc" class="myDivClassNormal"></div>
        <br>
        
        <!--<h1 style='page-break-before: always;'>Page 2</h1>-->

        <table style="width:100%; background-color: #f2f5f9"><tr><td><b>Implementing Party</b></td></tr></table>
        <div id="dNumberOfRecordsbyImpParty" class="myDivClassNormal"></div>

        <table style="width:100%; background-color: #f2f5f9"><tr><td><b>Activity</b></td></tr></table>
        <div id="dNumberOfRecordsbyActivity" background:red;></div>

        <!--<h1 style='page-break-before: always;'>Page 3</h1>-->
        <table style="width:100%; background-color: #f2f5f9; margin-bottom:1px"><tr><td><b>SubActivities</b></td></tr></table>
        <div id="dNumberOfRecordsbySubActivity" class="myDivClassNormal"></div>

        <!--<h1 style='page-break-before: always;'>Page 4</h1>-->

        <table style="width:100%; background-color: #f2f5f9"><tr><td><b>Office</b></td></tr></table>
        <div id="dNumberOfRecordsbyOffice" class="myDivClassNormal"></div>

        <!--<h1 style='page-break-before: always;'>Page 5</h1>-->
        <table style="width:100%; background-color: #f2f5f9"><tr><td><b>Overlapping Areas: States</b></td></tr></table>
        <div id="dNumberofOverlappingStates" class="myDivClassNormal"></div>

        <table style="width:100%; background-color: #f2f5f9"><tr><td><b>Overlapping Areas: States (continuted)</b></td></tr></table>
        <div id="dGISStates" class="myDivClassNormal"></div>
        <!--<h1 style='page-break-before: always; '>Page 6</h1>-->
        <table style="width:100%; background-color: #f2f5f9; margin-bottom:1px; padding-bottom:1px">            <tr>                <td><b>Overlapping Areas: GRSG Population Areas</b></td>            </tr>        </table>
        <div id="dNumberofOverlappingPopAreas" class="myDivClassSmall"></div>

        <!--<h1 style='page-break-before: always;'>Page 7</h1>-->
        
        <table style="width:100%; background-color: #f2f5f9; margin-bottom:1px"><tr><td><b>Overlapping Areas: GRSG Population Areas (continuted)</b></td></tr></table>
        <div id="dGISPoP" class="myDivClassSmall"></div>
      
        <!--<h1 style='page-break-before: always; '>Page 8</h1>-->

            <table style="width:100%; background-color: #f2f5f9">            <tr>                <td><b>Overlapping Areas: Overlapping Mngmt Zones</b></td>            </tr>        </table>
            <div id="dNumberofOverlappingMngmtZones" class="myDivClass"></div>

            <table style="width:100%; background-color: #f2f5f9">            <tr>                <td><b>Overlapping Areas: WAFWA MANAGEMENT ZONES"</b></td>            </tr>        </table>
            <div id="dGISMZ" class="myDivClassNormal"></div>

        <!--<h1 style='page-break-before: always; '>Page 9</h1>-->

            <table style="width:100%; background-color: #f2f5f9">            <tr>                <td><b>Overlapping Areas: SURFACE MANAGEMENT AGENCY</b></td>            </tr>        </table>
            <div id="dGISSMA" class="myDivClassNormal"></div>

        <!--<h1 style='page-break-before: always; '>Page 10</h1>-->

            <table style="width:100%; background-color: #f2f5f9">            <tr>                <td><b>Overlapping Areas: GRSG GENERAL HABITAT MANAGEMENT AREAS</b></td>            </tr>        </table>
            <div id="dGISGHMA" class="myDivClassNormal"></div>

            <table style="width:100%; background-color: #f2f5f9">            <tr>                <td><b>Overlapping Areas: GRSG PRIORITY HABITAT MANAGEMENT AREAS</b></td>            </tr>        </table>
            <div id="dGISPHMA" class="myDivClassNormal"></div>
        <!--<h1 style='page-break-before: always; '>Page 11</h1>-->

            <table style="width:100%; background-color: #f2f5f9">            <tr>                <td><b>Overlapping Areas: RESILIENCE and RESISTANCE</b></td>            </tr>        </table>
            <div id="dGISRMZ" class="myDivClassNormal"></div>
            <table style="width:100%; background-color: #f2f5f9">            <tr>                <td><b>Overlapping Areas: GRSG POPULATION by MANAGEMENT ZONE</b></td>            </tr>        </table>
            <div id="dGISAB" class="myDivClassNormal"></div>

            <table style="width:100%; background-color: #f2f5f9">            <tr>                <td><b>Overlapping Areas:BREEDING HABITAT PROBABILITY</b></td>            </tr>        </table>
            <div id="dGISBD" class="myDivClassNormal"></div>

        <!--<h1 style='page-break-before: always; '>Page 12</h1>-->
            <table style="width:100%; background-color: #f2f5f9">            <tr>                <td><b>Overlapping Areas: BREEDING HABITAT PROBABILITY (continuted)</b></td>            </tr>        </table>
            <div id="dGISBP" class="myDivClassNormal"></div>
        <!--<h1 style='page-break-before: always; '>Page 13</h1>-->

            <table style="width:100%; background-color: #f2f5f9">            <tr>                <td><b>Overlapping Areas: RESILIENCE and RESISTANCE AND POPULATION INDEX </b></td>            </tr>        </table>
            <div id="dGISIDX" class="myDivClassNormal"></div>

            <table style="width:100%; background-color: #f2f5f9">            <tr>                <td><b>Overlapping Areas: GRSG PRIORITY AREAS for CONSERVATION (PACs</b></td>            </tr>        </table>
            <div id="dGISPACSum" class="myDivClassNormal"></div>


            <div>Note: GIS Acre values were calculated using Conus Albers/NAD 83 projected coordinate system</div>

        </div>

    </body>
</html>
