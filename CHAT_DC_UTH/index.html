<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <!--The viewport meta tag is used to improve the presentation and behavior of the samples 
      on iOS devices-->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"/>
    <title>DRAFT SCDC UHT - State CHAT Data Community Under the Hood Tool v1.0.2</title>
	<link rel="icon" type="image/png" href="images/nvchat_favicon.png"/>
	
	<link rel="stylesheet" href="nvchatstyle.css"/>
    <!--<link rel="stylesheet" href="https://js.arcgis.com/4.2/esri/themes/claro/dijit/claro.css"/>-->
    <link rel="stylesheet" href="https://js.arcgis.com/3.19/dijit/themes//tundra/tundra.css" />
    <link rel="stylesheet" href="https://js.arcgis.com/3.19/esri/css/esri.css"/>
    <link rel="stylesheet" href="https://js.arcgis.com/3.19/dgrid/css/dgrid.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet" media="screen">

  </head>
  
  <body class="claro">
	<div id="navBar">
        <!--<a href="http://www.ndow.org/Nevada_Wildlife/Maps_and_Data/NVCHAT/" target="_blank"><img id="ndowLogo" src="images/state-chat-logo-blue.png" alt="NDOW Logo" title="NDOW Home Page"></a>-->
        <a href="http://www.ndow.org/Nevada_Wildlife/Maps_and_Data/NVCHAT/" target="_blank"><img id="ndowLogo" height="85" src="images/CHAT_DC_logo.png" alt="NDOW Logo" title="NDOW Home Page"></a>
		<span id="mainNav">
			<a id="toolsNav">TOOLS</a>
			<a id="glossaryNav">GLOSSARY</a>
            <a id="siteInfo"></a>
            <input id="btn_2CSV" type="button" value="Export Under the Hood records to CSV spreadsheet" style='margin-right:5px' />

  		<!--<a href="http://www.ndow.org/Nevada_Wildlife/Maps_and_Data/NVCHAT/FAQs" target="_blank" class="ndowNav">FAQs</a>-->
		</span>
		<img id="baseMaps" src="images/basemaps.png" alt="Basemaps">
		<a href="http://www.wafwachat.org" target="_blank"><img id="wafwaLogo" src="images/wafwachatlogo.png" alt="WAFWA CHAT Logo" title="Western Association of Fish and Wildlife Agencies' CHAT"></a>
	</div>
	
	<div id="submenuTools" class="subMenu">
		<ul class="listnostyle">
			<li><a id="queryPoint"><img class="toolsIcon" id="qryIcon" src="images/target16.png" alt="Query Point">Query</a></li>
			<li><a id="drawPoints"><img class="toolsIcon" id="pntIcon" src="images/drawpointsm.png" alt="Draw Point(s)">Points</a></li>
			<li><a id="drawLine"><img class="toolsIcon" id="lineIcon" src="images/drawlinesm.png" alt="Draw Line">Line</a></li>
			<li><a id="drawPoly"><img class="toolsIcon" id="polyIcon" src="images/drawpolygonsm.png" alt="Draw Polygon">Polygon</a></li>
			<li><a id="drawCircle"><img class="toolsIcon" id="circleIcon" src="images/drawcirclesm.png" alt="Draw Circle">Circle</a></li>
			<li><a id="drawRect"><img class="toolsIcon" id="rectIcon" src="images/drawrectanglesm.png" alt="Draw Rectangle">Rectangle</a></li>
			<li><a id="drawClear"><img class="toolsIcon" id="clearIcon" src="images/erasersm.png" alt="Clear Drawing">Clear</a></li>
		</ul>
	</div>
	
	<div id="submenuGlossary" class="subMenu">
		<ul>
			<li><b>BLM:</b> United States Bureau of Land Management</li>
			<li><b>CCVI:</b> Climate Change Vulnerability Index as determined by the NNHP</li>
			<li><b>CHAT:</b> Crucial Habitat Assessment Tool</li>
			<li><b>GAP:</b> Gap Analysis Program administered by the USGS</li>
			<li><b>GNIS:</b> Geographic Names Information System maintained by the USGS</li>
			<li><b>LCM:</b> Landscape Condition Model developed by NatureServe (2009)</li>
			<li><b>LIQT:</b> Landscape Integrity Quality Threshold based upon LCM scores that represent at least 80% of PAD Status 1 & 2 areas.</li>
			<li><b>LS Cond:</b> Landscape condition as modeled by the NatureServe Landscape Condition Model</li>
			<li><b>NHD:</b> National Hydrography Dataset maintained by the USGS</li>
			<li><b>NNHP:</b> Nevada Natural Heritage Program</li>
			<li><b>NWI:</b> National Wetlands Inventory maintained by the USFWS</li>
			<li><b>PAD:</b> Protected Areas Database maintained by the USGS</li>
			<li><b>S-Rank:</b> State conservation rank as determined by the NNHP
				<ul id="sranks" class="listnostyle">
					<li><i>S1:</i> Critically Imperilled</li>
					<li><i>S2:</i> Imperilled</li>
					<li><i>S3:</i> Vulnerable</li>
					<li><i>S4:</i> Apparently Secure</li>
					<li><i>S5:</i> Secure</li>
				</ul>
			</li>
			<li><b>SOC:</b> Species of Concern as identified by the Nevada State Wildlife Action Plan (2012)</li>
			<li><b>SERI:</b> Species of Economic and Recreational Importance</li>
			<li><b>SynthMap:</b> Nevada Vegetation Synthesis Map developed by the NNHP (2008)</li>
			<li><b>USFWS:</b> United States Fish & Wildlife Service</li>
			<li><b>USGS:</b> United States Geological Survey</li>
			<li><b>Wet/Rip:</b> Wetland and/or riparian habitat</li>
			<li><b>WGA:</b> Western Governors' Association</li>
			<li><b>WGWC:</b> Western Governors' Wildlife Council</li>
		</ul>
	</div>	
	
	<span id="chartArea">
        <div id="myTableNode"></div>
	</span>

 <!--   <div id="bot" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:'bottom', splitter:true">
        <div id="myTableNode"></div>
    </div>-->
	
	<div id="legendArea">
		<img id="infoCHAT" src="images/help_black.png" alt="Info">
		<div id="legendCHAT" class="legendDiv">
			<h4 id="legendHeadCHAT">Crucial Habitat Rank</h4>
			<ul class="inlineLegend">
				<li class="legendItem" id="legendCHAT1" style="background-color: #000070">1</li>
				<li class="legendItem" id="legendCHAT2" style="background-color: #002EB5">2</li>
				<li class="legendItem" id="legendCHAT3" style="background-color: #007FE6">3</li>
				<li class="legendItem" id="legendCHAT4" style="background-color: #00DEFF">4</li>
				<li class="legendItem" id="legendCHAT5" style="background-color: #96FAFF">5</li>
				<li class="legendItem" id="legendCHAT6" style="background-color: #DEFFFF">6</li>
			</ul>
			<span class="legendLabels">
				<span>Most Crucial</span>
				<span class="pullRight">Least Crucial</span>
			</span>
			<div id="sliderDivCHAT" class="sliderDiv"><a id="sliderCHAT"></a></div>
			<!--<input type="checkbox" id="toggleCHAT"></input>-->
            <input type="checkbox" id="toggleCHAT" checked></input>
			<label for="showLayer">Display</label>
		</div>
        	
        <br />
        <button type="button" class="btn btn-info" style="position:relative; font-size:12px; left:25px; padding-top:1px; padding-bottom:1px; vertical-align:text-top;" data-toggle="collapse" data-target="#legendSOC">Show/Hide PADUS/GAP Option</button>
        <div id="legendSOC" class="legendTallDiv  in">
            <h4 id="legendHeadSOC">Status: PADUS/GAP USGS</h4>
            <img src="images/GAP_Status.JPG" alt="GAP_Status" width="280">
            <div id="sliderDivSOC" class="sliderDiv2"><a id="sliderSOC"></a></div>
            <input type="checkbox" id="toggleSOC" style="top:-21px"></input>
            <label for="showLayer" style="top:-23px">Display</label>
        </div>

        <br />
        <button type="button" class="btn btn-info" style="position:relative; font-size:12px; left:25px; padding-top:1px; padding-bottom:1px; vertical-align:text-top;" data-toggle="collapse" data-target="#legendSERI">Show/Hide Ownership Option</button>
		<div id="legendSERI" class="legendTallDiv in">
			<h4 id="legendHeadSERI">Fed/Tribal/Other: PADUS/GAP USGS</h4>
            <img src="images/GAP_FedTribOther.JPG" alt="GAP_Status" width="150">
            <br />
            <div id="sliderDivSERI" class="sliderDiv2"><a id="sliderSERI"></a></div>
            <input type="checkbox" id="toggleSERI" style="top:-21px"></input>
            <label for="showLayer" style="top:-23px">Display</label>
		</div>

		
	
	</div>
	
	<div id="baseMapGallery">
		<div class="arrow"></div>
		<table>
			<tr>
				<td><img class="thumbActive" id="bmStreets" src="images/bm_streets.jpg" alt="Streets"></td>
				<td class="thumbLabel">Streets</td>
			</tr>
			<tr>
			<td><img id="bmTopo" src="images/bm_topo.jpg" alt="Topo"></td>
				<td class="thumbLabel">Topographic</td>
			</tr>
			<tr>
				<td><img id="bmSatellite" src="images/bm_satellite.jpg" alt="Imagery"></td>
				<td class="thumbLabel">Imagery</td>
			</tr>
			<tr>
				<td><img id="bmHybrid" src="images/bm_hybrid.png" alt="Labelled Imagery"></td>
				<td class="thumbLabel">Labelled Imagery</td>
			</tr>
			<tr>
				<td><img id="bmGray" src="images/bm_gray.png" alt="Simple Gray"></td>
				<td class="thumbLabel">Simple Gray</td>
			</tr>
		</table>
	</div>

    <script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-55453084-1', 'auto');
	  ga('send', 'pageview');
	</script>
    <script src="https://js.arcgis.com/3.27/"></script>
	<script type="text/javascript" src="tooltips.js"></script>
    <script type="text/javascript">
        var app = {};
        require([
        "esri/arcgis/Portal", "esri/arcgis/OAuthInfo", "esri/IdentityManager",
        "dojo/data/ItemFileReadStore",
        "dojo/_base/array",
        "dojo/store/Memory",
        "dgrid/OnDemandGrid",
        "dgrid/Selection",
		"esri/geometry/Point",
        "esri/map", "esri/layers/VectorTileLayer",
		"esri/toolbars/draw",
		"esri/dijit/InfoWindow",
		"esri/layers/FeatureLayer",
		"esri/layers/ArcGISTiledMapServiceLayer",
        "esri/layers/ArcGISDynamicMapServiceLayer",
		"esri/symbols/SimpleMarkerSymbol",
		"esri/symbols/SimpleFillSymbol",
		"esri/symbols/SimpleLineSymbol",
		"esri/symbols/CartographicLineSymbol",
		"esri/tasks/QueryTask",
		"esri/tasks/query",
		"esri/graphic",
                "dijit/registry",
        "dojo/_base/declare",
		"dojo/_base/array",
		"dojo/_base/Color",
        "dojo/date/locale",
		"dojo/_base/window",
		"dojo/on",
		"dojo/dom",
		"dojo/dom-construct",
		"dijit/layout/BorderContainer",
		"dijit/layout/AccordionContainer",
		"dijit/form/HorizontalSlider",
		"dijit/layout/ContentPane",
		"dojox/charting/Chart",
		"dojox/charting/plot2d/Bars",
		"dojox/charting/plot2d/Pie",
		"dojox/charting/axis2d/Default",
		"dojox/charting/action2d/Highlight",
		"dojox/charting/action2d/Tooltip",
		"dojox/charting/action2d/MoveSlice",
        "dojox/charting/themes/Tufte",
		"dojo/domReady!"
        ], function (
            arcgisPortal, OAuthInfo, esriId,
            ItemFileReadStore,array, Memory, Grid, Selection,
		Point,
        Map,VectorTileLayer,
		Draw,
		InfoWindow,
		FeatureLayer,
		ArcGISTiledMapServiceLayer,
        ArcGISDynamicMapServiceLayer,
		SimpleMarkerSymbol,
		SimpleFillSymbol,
		SimpleLineSymbol,
		CartographicLineSymbol,
		QueryTask,
		Query,
		Graphic,
        registry,
        declare,
		arrayUtils,
		Color,
        locale,
		win,
		on,
		dom,
		domConstruct,
		BorderContainer,
		AccordionContainer,
		HorizontalSlider,
		ContentPane,
		Chart,
		Bars,
		Pie,
		Default,
		Highlight,
		ChrtTooltip,
		MoveSlice,
        theme
	  ) {
            app.data = null;
            app.pGrid = null;
            app.memStore = null;

            document.getElementById('btn_2CSV').style.visibility = 'hidden';

            //Create layout widgets for application
            var bcMain = new BorderContainer( {id: "bcMain",design: "sidebar",gutters: false,}, domConstruct.create("div"));
            var cpMap = new ContentPane({ id: "map", region: "center", style: "border: solid thin silver; overflow: hidden" }, domConstruct.create("div"));
            bcMain.addChild(cpMap);
                        
            var cpMap2 = new ContentPane({ id: "gridCP", region: "bottom", splitter: "true"}, domConstruct.create("div"));
            bcMain.addChild(cpMap2);
		
            var pbtn_2CSV = dojo.byId("btn_2CSV");
            on(pbtn_2CSV, "click", btn_2CSV_click);

            document.body.appendChild(bcMain.domNode);
            bcMain.startup();
		
            var infoWindow = new InfoWindow({}, domConstruct.create("div"));//Create infoWindow to replace default popup window, infoWindow is used to allow full customization of chart content
            infoWindow.startup();
            //Create symbol for displaying selected feature
            var selectSymbol = new SimpleFillSymbol( 			SimpleFillSymbol.STYLE_NULL, 			new SimpleLineSymbol(				SimpleLineSymbol.STYLE_SOLID,				new Color("yellow"), 				3),			new Color(null)		);
            //Create symbols for displaying user drawn graphics
            var markerSymbol = new SimpleMarkerSymbol(			SimpleMarkerSymbol.STYLE_SQUARE,			10,			new SimpleLineSymbol(				SimpleLineSymbol.STYLE_SOLID,				new Color("black"),				1			),			new Color([255, 0 , 0])		);
            var lineSymbol = new CartographicLineSymbol(			CartographicLineSymbol.STYLE_SOLID,			new Color([255, 0, 0]), 			3,			CartographicLineSymbol.CAP_ROUND,			CartographicLineSymbol.JOIN_BEVEL		);
            var fillSymbol = new SimpleFillSymbol(			SimpleFillSymbol.STYLE_SOLID,			new SimpleLineSymbol(				SimpleLineSymbol.STYLE_SOLID,				new Color([255, 0, 0]),				2			),			new Color([255, 255, 0, 0.4])		);
		
            //Update chart theme with custom settings
            theme.chart.fill="transparent";
            theme.plotarea.fill="transparent";
            theme.series.font="normal normal bold 8pt Arial";
            theme.series.fontColor="black";	
		
            //Create map
            var map = new Map("map", {basemap: "streets",			center: [-127, 55],			zoom: 4,			sliderStyle: "large",			sliderPosition: "bottom-right",			infoWindow: infoWindow		});	


            ////Tiled map service for CHAT data
            //var nvCHAT = new ArcGISTiledMapServiceLayer("https://tiles.arcgis.com/tiles/QVENGdaPbd4LUkLV/arcgis/rest/services/UTH_TileLayer_CHRank/MapServer",
            //    {opacity: 0.5, resampling: true });

            //var nvCHAT = new ArcGISTiledMapServiceLayer("https://tiles.arcgis.com/tiles/QVENGdaPbd4LUkLV/arcgis/rest/services/CHAT_SOC_Rank/MapServer",
            //    { opacity: 0.5, resampling: true });
            var nvCHAT = new ArcGISTiledMapServiceLayer("https://tiles.arcgis.com/tiles/QVENGdaPbd4LUkLV/arcgis/rest/services/UTH_TileLayer_CHRank/MapServer",
                { opacity: 0.5, resampling: true });


            


            var nvSOC = new ArcGISDynamicMapServiceLayer("https://gis1.usgs.gov/arcgis/rest/services/PADUS1_4/GAP_Status_Code/MapServer", { opacity: 0 });
            var nvSERI = new ArcGISDynamicMapServiceLayer("https://gis1.usgs.gov/arcgis/rest/services/PADUS1_4/Fed_Tribal_Other/MapServer", { opacity: 0 });
            //Feature layer for CHAT data queries
            var nvCHATFL = new esri.layers.FeatureLayer("https://services.arcgis.com/QVENGdaPbd4LUkLV/arcgis/rest/services/UTH_AGOLv2/FeatureServer/0", {
                opacity: 0,
                mode: FeatureLayer.MODE_SELECTION, outFields: ["CH_Rank", "HexID", "Ter_SOC", "Ter_SERI", "Wet_Rip", "LS_Cond"]
            });
            nvCHATFL.setSelectionSymbol(selectSymbol);

            nvCHATFL.on("selection-complete", function () {
                dojo.byId("siteInfo").innerHTML = "Getting selected Hex's";
                var results = nvCHATFL.getSelectedFeatures();
                if (results.length > 0) {
                    var tbStatus = "off";
                    Query4Relates(results)
                }
                map.setMapCursor("default");
                map.enableMapNavigation();
            });

            //var info = new OAuthInfo({ appId: "4y78XrGDoCd8wys2", popup: false });  //local
            //esriId.registerOAuthInfos([info]);
            //esriId.getCredential(info.portalUrl + "/sharing");                // user will be redirected to OAuth Sign In page
            //esriId.checkSignInStatus(info.portalUrl + "/sharing").then(
            //  function () {
                  map.addLayers([nvSERI, nvSOC, nvCHAT, nvCHATFL]);
                  //Set custom mouse cursor when over Nevada data layers
                  nvCHATFL.on("mouse-over", function () {
                      if (tbStatus === "off") {
                          map.setMapCursor("url(images/target25.png) 12 12, auto");
                      }
                  });

                  nvCHATFL.on("mouse-out", function () {map.setMapCursor("default");});

                  var sliderCHAT = new HorizontalSlider({ value: 50, minimum: 1, maximum: 100, intermediateChanges: true, showButtons: false, onChange: function (value) { nvCHAT.setOpacity(value / 100); } }, "sliderCHAT");
                  document.getElementById("sliderDivCHAT").style.visibility = "visible";
                  var sliderSOC = new HorizontalSlider({ value: 50, minimum: 1, maximum: 100, intermediateChanges: true, showButtons: false, onChange: function (value) { nvSOC.setOpacity(value / 100); } }, "sliderSOC");
                  document.getElementById("sliderDivSOC").style.visibility = "hidden";
                  var sliderSERI = new HorizontalSlider({ value: 50, minimum: 1, maximum: 100, intermediateChanges: true, showButtons: false, onChange: function (value) { nvSERI.setOpacity(value / 100); } }, "sliderSERI");
                  document.getElementById("sliderDivSERI").style.visibility = "hidden";

                  //Show/hide layers on legend click event
                  document.getElementById("toggleCHAT").onclick = function () { layerToggle(nvCHAT, document.getElementById("sliderDivCHAT")); }
                  document.getElementById("toggleSOC").onclick = function () { layerToggle(nvSOC, document.getElementById("sliderDivSOC")); }
                  document.getElementById("toggleSERI").onclick = function () { layerToggle(nvSERI, document.getElementById("sliderDivSERI")); }
            //  }
            //).otherwise(function () { });// Do nothing
		
            
            //Function to show/hide data layers on legend click event
            function layerToggle(layer, sliderElement) {
                if (layer.opacity > 0) {
                    layer.setOpacity(0);
                    sliderElement.style.visibility = "hidden";
                }
                else {
                    layer.setOpacity(0.5);
                    sliderElement.style.visibility = "visible";
                }
                layer.refresh();
            }
				
            //Show basemap gallery on click event
            var baseMapButton = document.getElementById("baseMaps");
            var baseMapGallery = document.getElementById("baseMapGallery");
            baseMapButton.onclick = function() {
                if (baseMapGallery.style.visibility != "visible") {
                    baseMapButton.style.background = "#ccbda6";
                    baseMapGallery.style.visibility = "visible";
                }
                else {
                    baseMapButton.style.background = "transparent";
                    baseMapGallery.style.visibility = "hidden";
                }
            }
		
            //Change base map on click event		
            document.getElementById("bmStreets").onclick = function() {
                changeBM(bmStreets = document.getElementById("bmStreets"), "streets");
            }
            document.getElementById("bmTopo").onclick = function() {
                changeBM(bmStreets = document.getElementById("bmTopo"), "topo");
            }
            document.getElementById("bmSatellite").onclick = function() {
                changeBM(bmStreets = document.getElementById("bmSatellite"), "satellite");
            }
            document.getElementById("bmHybrid").onclick = function() {
                changeBM(bmStreets = document.getElementById("bmHybrid"), "hybrid");
            }
            document.getElementById("bmGray").onclick = function() {
                changeBM(bmStreets = document.getElementById("bmGray"), "gray");
            }

            function btn_2CSV_click() {
                var array2send = [["HexID", "Elmt_Name", "Elmt_Class", "Elmt_Code", "Sci_Name", "Elmt_Type", "Abund", "AbundUnit", "Obsrv_Date", "Src_Data", "Src_ID", "Src_Date", "Src_Geom", "OBJECTID"]];
                dojo.forEach(app.data, function (pItem) {
                    var tempArray = [];
                    for (var prop in pItem) {
                        if (pItem.hasOwnProperty(prop)) {
                            tempArray.push(pItem[prop]);
                        }
                    }
                    array2send.push(tempArray);
                });

                exportToCsv('under_the_hood_records.csv', array2send);
            }

            function exportToCsv(filename, rows) {
                var processRow = function (row) {
                    var finalVal = '';
                    for (var j = 0; j < row.length; j++) {
                        var innerValue = row[j] === null ? '' : row[j].toString();
                        if (row[j] instanceof Date) {
                            innerValue = row[j].toLocaleString();
                        };
                        var result = innerValue.replace(/"/g, '""');
                        if (result.search(/("|,|\n)/g) >= 0)
                            result = '"' + result + '"';
                        if (j > 0)
                            finalVal += ',';
                        finalVal += result;
                    }
                    return finalVal + '\n';
                };

                var csvFile = '';
                for (var i = 0; i < rows.length; i++) {
                    csvFile += processRow(rows[i]);
                }

                var blob = new Blob([csvFile], { type: 'text/csv;charset=utf-8;' });
                if (navigator.msSaveBlob) { // IE 10+
                    navigator.msSaveBlob(blob, filename);
                } else {
                    var link = document.createElement("a");
                    if (link.download !== undefined) { // feature detection
                        // Browsers that support HTML5 download attribute
                        var url = URL.createObjectURL(blob);
                        link.setAttribute("href", url);
                        link.setAttribute("download", filename);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                }
            }
		
            function ClearMapandTable() {
                document.getElementById('btn_2CSV').style.visibility = 'hidden';
                tb.deactivate();
                map.enableMapNavigation();
                map.graphics.clear();
                tbStatus = "off";
                nvCHATFL.clearSelection();

                if (app.pGrid) {
                    app.data = new dojo.data.ItemFileReadStore({ data: { identifier: "", items: [] } });
                    app.memStore = new Memory({ data: app.data });
                    app.pGrid.set("store", app.memStore);
                    app.pGrid.refresh();
                }
                dojo.byId("siteInfo").innerHTML = "Map and Table Cleared";
                tb.deactivate();
            }

            //Function to change basemap using custom basemap gallery
            function changeBM(bmElement, bmNew) {
                document.getElementById("bmStreets").className = "";
                document.getElementById("bmTopo").className = "";
                document.getElementById("bmSatellite").className = "";
                document.getElementById("bmHybrid").className = "";
                document.getElementById("bmGray").className = "";
			
                bmElement.className = "thumbActive";
                map.setBasemap(bmNew);
            }
				
            //Initialize draw/query tools
            var tb = new Draw(map);
            tb.deactivate();
            var tbStatus = "off";
		
            //Show/hide draw and query tools on click event
            var submenuTools = document.getElementById("submenuTools");
            document.getElementById("toolsNav").onclick = function() {
                if (submenuTools.style.visibility == "visible") {
                    submenuTools.style.visibility = "hidden";
                    toolsNav.className = "";
                    tb.deactivate();
                    tbStatus = "off";
                }
                else {
                    submenuTools.style.visibility = "visible";
                    toolsNav.className = "active";
                }
            }
		
            //Activate draw/query tool on click event		
            document.getElementById("queryPoint").onclick = function () {
                ClearMapandTable();
                map.enableMapNavigation();
                tbStatus = "off";
            }
            document.getElementById("drawPoints").onclick = function() {
                ClearMapandTable();
                drawQuery("multipoint");
            }		
            document.getElementById("drawLine").onclick = function() {
                ClearMapandTable();
                drawQuery("polyline");
            }		
            document.getElementById("drawPoly").onclick = function() {
                ClearMapandTable();
                drawQuery("polygon");
            }		
            document.getElementById("drawCircle").onclick = function() {
                ClearMapandTable();
                drawQuery("circle");
            }		
            document.getElementById("drawRect").onclick = function() {
                ClearMapandTable();
                drawQuery("rectangle");
            }
            document.getElementById("drawClear").onclick = function() {
                ClearMapandTable();
            }
		
            //Show glossary on mouse over event
            var submenuGlossary = document.getElementById("submenuGlossary");
            document.getElementById("glossaryNav").onmouseover = function() {
                submenuGlossary.style.visibility = "visible";
            }
		
            //Hide glossary on mouse out event
            document.getElementById("glossaryNav").onmouseout = function() {
                submenuGlossary.style.visibility = "hidden";
            }
		
            //Query CHAT data on single map click event		
            map.on("click", function(evt) {
                if (tbStatus === "off") {
                    //nvCHATFL.clearSelection();
                    var scale = map.getScale();
                    var minMapScale = nvCHAT.minScale;

                    var temoMaxMapScale = nvCHAT.maxScale;

                    //Respond if map scale is too large to display CHAT data
                    if ((scale > minMapScale) & (minMapScale != 0)) {
                        map.infoWindow.resize(300, 55);
                        map.infoWindow.setTitle("<b>Data Not Available At This Scale</b>");
                        map.infoWindow.setContent("Zoom in to select data.");
                        map.infoWindow.show(evt.mapPoint);	
                    }
                        //Respond if map scale displays CHAT data
                    else {
                        var qCHAT = new Query();
                        qCHAT.geometry = evt.mapPoint;					
                        map.infoWindow.resize(305, 205);
                        map.infoWindow.setTitle("<b>Crucial Habitat Assessment</b>");
                        nvCHATFL.selectFeatures(qCHAT, FeatureLayer.SELECTION_NEW, function(results) {						
                            if (results.length > 0) {
                                map.infoWindow.show(evt.mapPoint);
                                createChart(results);
                            }
                            else {
                                map.infoWindow.hide()
                            }
                        });
                    }
                }			
            });
		
            //Function to add map graphics, select hexagons, and query data based on drawn area of interest
            function drawQuery(graphicType) {
                tb.deactivate();
                map.graphics.clear();
                tbStatus = "off";
                nvCHATFL.clearSelection();
                //clearCharts();

                if (tbStatus === "off") {
                    nvCHATFL.clearSelection();
                }
                var tbStatus = "on";

                map.disableMapNavigation();
                tb.activate(graphicType);
                tb.on("draw-end", function(evtGraph) {
                    var tbStatus = "on";
                    map.setMapCursor("wait");
                    tb.deactivate();
				
                    var symbol;
                    switch (evtGraph.geometry.type) {
                        case "multipoint":
                            symbol = markerSymbol;
                            break;
                        case "polyline":
                            symbol = lineSymbol;
                            break;
                        default:
                            symbol = fillSymbol;
                            break;
                    }
                    var tbStatus = "on";
                    map.graphics.add(new Graphic(evtGraph.geometry, symbol));
                    var qCHAT = new Query();
                    qCHAT.geometry = evtGraph.geometry;
                    nvCHATFL.selectFeatures(qCHAT, FeatureLayer.SELECTION_ADD);
                });
            }	


            function Query4Relates(results) {
                dojo.byId("siteInfo").innerHTML = "Hex's selected";

                var arrayHexs = [];
                if ((results != null) || (results != undefined)) {
                    if (results.length > 0) {
                        dojo.forEach(results, function (feature) {
                            var attr = feature.attributes;
                            var strhex_id = "n/a";
                            if (attr.HexID != undefined && attr.HexID != null) {
                                hexid = attr.HexID;
                                arrayHexs.push("'" + hexid + "'");
                            }
                        });
                    }
                }
                strWhere = "HexID in (" + arrayHexs.join() + ")";

                var pQueryTask = new esri.tasks.QueryTask("https://services.arcgis.com/QVENGdaPbd4LUkLV/arcgis/rest/services/UTH_AGOLv2/FeatureServer/1");
                var pQuery = new esri.tasks.Query();
                pQuery.outFields = ["HexID", "Elmt_Name", "Elmt_Class", "Elmt_Code", "Sci_Name", "Elmt_Type", "Abund", "AbundUnit", "Obsrv_Date", "Src_Data", "Src_ID", "Src_Date", "Src_Geom", "OBJECTID"];
                pQuery.returnGeometry = false;
                pQuery.where = strWhere;
                dojo.byId("siteInfo").innerHTML = "Finding related records";
                pQueryTask.execute(pQuery, qryNonSpatialResults, err);
            }

            function err(err) {
                varStrErrorMessage = err.message;
            }


            //Zoom to the parcel when the user clicks a row
            function onRowClickHandler(evt) {
                var clickedTaxLotId = event.rows[0].data.PARCELID;
                var selectedTaxLot = arrayUtils.filter(map.graphics.graphics, function (graphic) {
                    return ((graphic.attributes) && graphic.attributes.PARCELID === clickedTaxLotId);
                });
                if ( selectedTaxLot.length ) {
                    map.setExtent(selectedTaxLot[0].geometry.getExtent(), true);
                }
            }

            function qryNonSpatialResults(results) {
                var botContainer = registry.byId("gridCP");
                
                if (botContainer.containerNode.style.height == "") {
                    var bc = registry.byId('bcMain');
                    var newSize = 150;
                    dojo.style(botContainer.domNode, "height", 25 + "%");
                    bc.resize();
                }
                
                if (!app.pGrid) {
                    var columns = [    // Create a new constructor by mixing in the components // Allow row selection for the grid columns for the grid 
                      { 'field': 'HexID', 'label': 'Hex ID' },
                      { 'field': 'Elmt_Name', 'label': 'Element Name' },
                    { 'field': 'Elmt_Class', 'label': "Element Class" },
                    { 'field': 'Elmt_Code', 'label': "Element Code" },
                    { 'field': 'Sci_Name', 'label': "Scientific Name" },
                    { 'field': 'Elmt_Type', 'label': "Element Type" },
                    { 'field': 'Abund', 'label': "Abundance" },
                    { 'field': 'AbundUnit', 'label': "Abund Unit" },
                    { 'field': 'Obsrv_Date', 'label': "Observation Date" },
                    { 'field': 'Src_Data', 'label': "Source Data Name" },
                    { 'field': 'Src_ID', 'label': 'Source Identifier' },
                    { 'field': 'Src_Date', 'label': 'Source Date' },
                    { 'field': 'Src_Geom', 'label': 'Source Geometry' },
                    { 'field': 'OBJECTID', 'label': 'Record ID', width: "30%" }
                    ];

                    app.pGrid = new (declare([Grid, Selection]))({                  // use Infinity so that all data is available in the grid
                        bufferRows: Infinity,
                        columns: columns
                    }, "gridCP"
                    );
                }

                app.pGrid.on("dgrid-select", onRowClickHandler);
                resultFeatures = results.features;

              app.data = array.map(resultFeatures, function (feature) {
                  return {
                      // property names used here match those used when creating the dgrid
                      "HexID": feature.attributes['HexID'],
                      "Elmt_Name": feature.attributes['Elmt_Name'],
                      "Elmt_Class": feature.attributes['Elmt_Class'],
                      "Elmt_Code": feature.attributes['Elmt_Code'],
                      "Sci_Name": feature.attributes['Sci_Name'],
                      "Elmt_Type": feature.attributes['Elmt_Type'],
                      "Abund": feature.attributes['Abund'],
                      "AbundUnit": feature.attributes['AbundUnit'],
                      "Obsrv_Date": locale.format(new Date(feature.attributes['Obsrv_Date']), {
                          datePattern: "MM/dd/y",
                          selector: "date"
                      }).replace("12/31/1969",""),
                      "Src_Data": feature.attributes['Src_Data'],
                      "Src_ID": feature.attributes['Src_ID'],
                      "Src_Date": locale.format(new Date(feature.attributes['Src_Date']), {
                          datePattern: "MM/dd/y",
                          selector: "date"
                      }),
                      "Src_Geom": feature.attributes['Src_Geom'],
                      "OBJECTID": feature.attributes['OBJECTID']
                  };
              });


              app.pGrid.refresh();              ////display the results in the grid
              //app.pGrid.renderArray(app.data);
              app.memStore = new Memory({ data: app.data });
              app.pGrid.set("store", app.memStore);
              delete resultFeatures;
              dojo.byId("siteInfo").innerHTML = app.data.length + " related records found";
              document.getElementById('btn_2CSV').style.visibility = 'visible';
          }

		//Function to create chart content based on single map click query
          function createChart(features) {
              document.getElementById("chartArea").style.backgroundColor = "rgba(0,0,0,0)";
              document.getElementById("chartArea").style.zIndex = "-10";

			var feature = features[0];
			var attr = feature.attributes;
			var CHAT = attr.CH_Rank;
			var SOC = attr.Ter_SOC;
			var SERI = attr.Ter_SERI;
			var WetRip = attr.Wet_Rip;
			var LSCond = attr.LS_Cond;
			
			var c = domConstruct.create("div", {
				id: "infoWinDiv",
				style: "height: 163px; width: 292px;"
			});
			
			map.infoWindow.setContent(c);
			
			//Create bar chart of CHAT ranks
			var chart = new Chart(c, {
				title: "<b>Crucial Habitat Rank: " + CHAT + "</b>",
				titleFontColor: "#000070",
				titleFont: "normal normal bold 12pt Arial",
				titleGap: 5
			});
			
			chart.setTheme(theme);
			
			chart.addPlot("default", {
				type: Bars,
				gap: 3,
				maxBarSize: 40
			});
			
			chart.addAxis("x", {
				min: 0,
				max: 6,
				labels: [
					{value: 0, text: "Least Crucial"},
					{value: 1, text: ""},
					{value: 2, text: ""},
					{value: 3, text: ""},
					{value: 4, text: ""},
					{value: 5, text: ""},
					{value: 6, text: "Most Crucial"}
				],
				minorTicks: false,
				font: "normal normal bold 8pt Arial"
			});
			
			chart.addAxis("y", {
				vertical: true,
				labels: [
					{value: 1, text: "LS Cond"},
					{value: 2, text: "Wet/Rip"},
					{value: 3, text: "SERI"},
					{value: 4, text: "SOC"}
				],
				font: "normal normal bold 8pt Arial",
				minorTicks: false
			});
			
			chart.addSeries("inputData", [
				{x: 1, y: (7 - LSCond), fill: "#E6E600", tooltip: "Landscape Condition Rank: " + LSCond},
				{x: 2, y: (7 - WetRip), fill: "#70A800", tooltip: "Wetland/Riparian Habitat Rank: " + WetRip},
				{x: 3, y: (7 - SERI), fill: "#D99800", tooltip: "Terrestrial Species of Economic & Recreational Importance Rank: " + SERI},
				{x: 4, y: (7 - SOC), fill: "#A80000", tooltip: "Terrestrial Species of Concern Rank: " + SOC}
			]);
		
			new Highlight(chart, "default");
			new ChrtTooltip(chart, "default", {});
			
			chart.render();
		}
		
		//Function to create chart results based on multiple hexagon map query
		function chartMulti(results) {
			map.infoWindow.hide();
			clearCharts();
			
			var hexCnt = results.length;
			
			var CHAT1cnt = 0;
			var CHAT2cnt = 0;
			var CHAT3cnt = 0;
			var CHAT4cnt = 0;
			var CHAT5cnt = 0;
			var CHAT6cnt = 0;
			
			var SOC1cnt = 0;
			var SOC2cnt = 0;
			var SOC3cnt = 0;
			var SOC4cnt = 0;
			var SOC5cnt = 0;
			var SOC6cnt = 0;
			var SOC99cnt = 0;
			
			var SERI1cnt = 0;
			var SERI2cnt = 0;
			var SERI3cnt = 0;
			var SERI4cnt = 0;
			var SERI5cnt = 0;
			var SERI6cnt = 0;
			
			var WetRip1cnt = 0;
			var WetRip2cnt = 0;
			var WetRip3cnt = 0;
			var WetRip4cnt = 0;
			var WetRip5cnt = 0;
			var WetRip6cnt = 0;
			var WetRip99cnt = 0;
			
			var LS1cnt = 0;
			var LS2cnt = 0;
			var LS6cnt = 0;
			
			//Tabulate habitat rank counts for selected features
			results.forEach(function(feature) {
				var attr = feature.attributes;
				var CHAT = attr.CH_Rank;
				var SOC = attr.Ter_SOC;
				var SERI = attr.Ter_SERI;
				var WetRip = attr.Wet_Rip;
				var LSCond = attr.LS_Cond;
				
				switch (CHAT) {
					case 1:
						CHAT1cnt++;
						break;
					case 2:
						CHAT2cnt++;
						break;
					case 3:
						CHAT3cnt++;
						break;
					case 4:
						CHAT4cnt++;
						break;
					case 5:
						CHAT5cnt++;
						break;
					case 6:
						CHAT6cnt++;
						break;
				}
				
				switch (SOC) {
					case 1:
						SOC1cnt++;
						break;
					case 2:
						SOC2cnt++;
						break;
					case 3:
						SOC3cnt++;
						break;
					case 4:
						SOC4cnt++;
						break;
					case 5:
						SOC5cnt++;
						break;
					case 6:
						SOC6cnt++;
						break;
					case 9999:
						SOC99cnt++;
						break;
				}
				
				switch (SERI) {
					case 1:
						SERI1cnt++;
						break;
					case 2:
						SERI2cnt++;
						break;
					case 3:
						SERI3cnt++;
						break;
					case 4:
						SERI4cnt++;
						break;
					case 5:
						SERI5cnt++;
						break;
					case 6:
						SERI6cnt++;
						break;
				}
				
				switch (WetRip) {
					case 1:
						WetRip1cnt++;
						break;
					case 2:
						WetRip2cnt++;
						break;
					case 3:
						WetRip3cnt++;
						break;
					case 4:
						WetRip4cnt++;
						break;
					case 5:
						WetRip5cnt++;
						break;
					case 6:
						WetRip6cnt++;
						break;
					case 9999:
						WetRip99cnt++;
						break;
				}
				
				switch (LSCond) {
					case 1:
						LS1cnt++;
						break;
					case 2:
						LS2cnt++;
						break;
					case 6:
						LS6cnt++;
						break;
				}
			});
			
			//Format chart area
			document.getElementById("chartArea").style.backgroundColor="rgba(255,255,255,0.6)";
			document.getElementById("chartArea").style.zIndex="30";
			
			//Create pie chart of CHAT rank results
			var CHATchart = new Chart(CHATchrt, {
				title: "Overall Crucial Habitat",
				titleFont: "normal normal bold 12pt Arial",
				titleFontColor: "#000070",
				titleGap: 5
			});
			
			CHATchart.setTheme(theme);
			
			CHATchart.addPlot("default", {
				type: Pie,
				labelOffset: -20
			});
			
			CHATchart.addSeries("CHATdata", [
				{y: CHAT2cnt/hexCnt, fill: "#002EB5", tooltip: "<b>CHAT Rank 2</b>: " + CHAT2cnt + " out of " + hexCnt + " hexes."},
				{y: CHAT3cnt/hexCnt, fill: "#007FE6", tooltip: "<b>CHAT Rank 3</b>: " + CHAT3cnt + " out of " + hexCnt + " hexes."},
				{y: CHAT4cnt/hexCnt, fill: "#00DEFF", tooltip: "<b>CHAT Rank 4</b>: " + CHAT4cnt + " out of " + hexCnt + " hexes."},
				{y: CHAT5cnt/hexCnt, fill: "#96FAFF", tooltip: "<b>CHAT Rank 5</b>: " + CHAT5cnt + " out of " + hexCnt + " hexes."},
				{y: CHAT6cnt/hexCnt, fill: "#DEFFFF", tooltip: "<b>CHAT Rank 6</b>: " + CHAT6cnt + " out of " + hexCnt + " hexes."},
				{y: CHAT1cnt/hexCnt, fill: "#000070", tooltip: "<b>CHAT Rank 1</b>: " + CHAT1cnt + " out of " + hexCnt + " hexes."}
			]);
		
			new MoveSlice(CHATchart, "default");
			new Highlight(CHATchart, "default");
			new ChrtTooltip(CHATchart, "default", {});
			
			CHATchart.render();
			
			//Create pie chart of SOC rank results
			var SOCchart = new Chart(SOCchrt, {
				title: "Habitat for Sp. of Concern",
				titleFont: "normal normal bold 12pt Arial",
				titleFontColor: "#730000",
				titleGap: 5
			});
			
			SOCchart.setTheme(theme);
			
			SOCchart.addPlot("default", {
				type: Pie,
				labelOffset: -20,
			});
			
			SOCchart.addSeries("SOCdata", [
				{y: SOC2cnt/hexCnt, fill: "#A80000", tooltip: "<b>SOC Rank 2</b>: " + SOC2cnt + " out of " + hexCnt + " hexes."},
				{y: SOC3cnt/hexCnt, fill: "#E60000", tooltip: "<b>SOC Rank 3</b>: " + SOC3cnt + " out of " + hexCnt + " hexes."},
				{y: SOC4cnt/hexCnt, fill: "#FF7F7F", tooltip: "<b>SOC Rank 4</b>: " + SOC4cnt + " out of " + hexCnt + " hexes."},
				{y: SOC5cnt/hexCnt, fill: "#FFBEBE", tooltip: "<b>SOC Rank 5</b>: " + SOC5cnt + " out of " + hexCnt + " hexes."},
				{y: SOC6cnt/hexCnt, fill: "#FFDEE0", tooltip: "<b>SOC Rank 6</b>: " + SOC6cnt + " out of " + hexCnt + " hexes."},
				{y: SOC99cnt/hexCnt, fill: "#CCCCCC", tooltip: "<b>No SOC Data</b>: " + SOC99cnt + " out of " + hexCnt + " hexes."},
				{y: SOC1cnt/hexCnt, fill: "#730000", tooltip: "<b>SOC Rank 1</b>: " + SOC1cnt + " out of " + hexCnt + " hexes."}
			]);
		
			new MoveSlice(SOCchart, "default");
			new Highlight(SOCchart, "default");
			new ChrtTooltip(SOCchart, "default", {});
			
			SOCchart.render();
			
			//Create pie chart of SERI rank results
			var SERIchart = new Chart(SERIchrt, {
				title: "Habitat for Sp. of Econ./Rec. Importance",
				titleFont: "normal normal bold 12pt Arial",
				titleFontColor: "#9C6100",
				titleGap: 5
			});
			
			SERIchart.setTheme(theme);
			
			SERIchart.addPlot("default", {
				type: Pie,
				labelOffset: -20
			});
			
			SERIchart.addSeries("SERIdata", [
				{y: SERI2cnt/hexCnt, fill: "#D99800", tooltip: "<b>SERI Rank 2</b>: " + SERI2cnt + " out of " + hexCnt + " hexes."},
				{y: SERI3cnt/hexCnt, fill: "#FFAA00", tooltip: "<b>SERI Rank 3</b>: " + SERI3cnt + " out of " + hexCnt + " hexes."},
				{y: SERI4cnt/hexCnt, fill: "#FFD37F", tooltip: "<b>SERI Rank 4</b>: " + SERI4cnt + " out of " + hexCnt + " hexes."},
				{y: SERI5cnt/hexCnt, fill: "#FFEBAF", tooltip: "<b>SERI Rank 5</b>: " + SERI5cnt + " out of " + hexCnt + " hexes."},
				{y: SERI6cnt/hexCnt, fill: "#FFF2D4", tooltip: "<b>SERI Rank 6</b>: " + SERI6cnt + " out of " + hexCnt + " hexes."},
				{y: SERI1cnt/hexCnt, fill: "#9C6100", tooltip: "<b>SERI Rank 1</b>: " + SERI1cnt + " out of " + hexCnt + " hexes."}
			]);
		
			new MoveSlice(SERIchart, "default");
			new Highlight(SERIchart, "default");
			new ChrtTooltip(SERIchart, "default", {});
			
			SERIchart.render();
			
			//Create pie chart of Wetland/Riparian rank results
			var WetRipchart = new Chart(WetRipchrt, {
				title: "Wetland/Riparian Habitat",
				titleFont: "normal normal bold 12pt Arial",
				titleFontColor: "#4C5C00",
				titleGap: 5
			});
			
			WetRipchart.setTheme(theme);
			
			WetRipchart.addPlot("default", {
				type: Pie,
				labelOffset: -20
			});
			
			WetRipchart.addSeries("SOCdata", [
				{y: WetRip2cnt/hexCnt, fill: "#70A800", tooltip: "<b>Wetland-Riparian Rank 2</b>: " + WetRip2cnt + " out of " + hexCnt + " hexes."},
				{y: WetRip3cnt/hexCnt, fill: "#98E600", tooltip: "<b>Wetland-Riparian Rank 3</b>: " + WetRip3cnt + " out of " + hexCnt + " hexes."},
				{y: WetRip4cnt/hexCnt, fill: "#D1FF73", tooltip: "<b>Wetland-Riparian Rank 4</b>: " + WetRip4cnt + " out of " + hexCnt + " hexes."},
				{y: WetRip5cnt/hexCnt, fill: "#E9FFBE", tooltip: "<b>Wetland-Riparian Rank 5</b>: " + WetRip5cnt + " out of " + hexCnt + " hexes."},
				{y: WetRip6cnt/hexCnt, fill: "#F2FFE0", tooltip: "<b>Wetland-Riparian Rank 6</b>: " + WetRip6cnt + " out of " + hexCnt + " hexes."},
				{y: WetRip99cnt/hexCnt, fill: "#CCCCCC", tooltip: "<b>No Wetland-Riparian Data</b>: " + WetRip99cnt + " out of " + hexCnt + " hexes."},
				{y: WetRip1cnt/hexCnt, fill: "#4C5C00", tooltip: "<b>Wetland-Riparian Rank 1</b>: " + WetRip1cnt + " out of " + hexCnt + " hexes."}
			]);
		
			new MoveSlice(WetRipchart, "default");
			new Highlight(WetRipchart, "default");
			new ChrtTooltip(WetRipchart, "default", {});
			
			WetRipchart.render();
			
			//Create pie chart of LS Condition rank results
			var LSchart = new Chart(LSCondchrt, {
				title: "Landscape Condition",
				titleFont: "normal normal bold 12pt Arial",
				titleFontColor: "#CCB500",
				titleGap: 5
			});
			
			LSchart.setTheme(theme);
			
			LSchart.addPlot("default", {
				type: Pie,
				labelOffset: -20
			});
			
			LSchart.addSeries("LSdata", [
				{y: LS2cnt/hexCnt, fill: "#E6E600", tooltip: "<b>SOC Rank 2</b>: " + LS2cnt + " out of " + hexCnt + " hexes."},
				{y: LS6cnt/hexCnt, fill: "#FFFF00", tooltip: "<b>SOC Rank 6</b>: " + LS6cnt + " out of " + hexCnt + " hexes."},
				{y: LS1cnt/hexCnt, fill: "#CCB500", tooltip: "<b>SOC Rank 1</b>: " + LS1cnt + " out of " + hexCnt + " hexes."}
			]);
		
			new MoveSlice(LSchart, "default");
			new Highlight(LSchart, "default");
			new ChrtTooltip(LSchart, "default", {});
			
			LSchart.render();			
		}
		
		//Function to clear existing chart data if any
		function clearCharts() {
			document.getElementById("chartArea").style.backgroundColor="rgba(0,0,0,0)";
			document.getElementById("chartArea").style.zIndex="-10";
		
			var div = document.getElementById("CHATchrt");
			while(div.firstChild) {
				div.removeChild(div.firstChild);
			}
			var div = document.getElementById("SOCchrt");
			while(div.firstChild) {
				div.removeChild(div.firstChild);
			}
			var div = document.getElementById("SERIchrt");
			while(div.firstChild) {
				div.removeChild(div.firstChild);
			}
			var div = document.getElementById("WetRipchrt");
			while(div.firstChild) {
				div.removeChild(div.firstChild);
			}
			var div = document.getElementById("LSCondchrt");
			while(div.firstChild) {
				div.removeChild(div.firstChild);
			}
		}
      });
    </script>
  </body>
</html>